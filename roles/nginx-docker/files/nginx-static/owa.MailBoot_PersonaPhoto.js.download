self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~PersonaPhoto.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[699],{152:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(31);function i(){var e=Object(n.a)(),t=e.origin;return t||(t=e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")),t}},157:function(e,t,r){"use strict";function n(){var e=Object.create(null),t=0,r=0,n=0,i=!1;function a(t){n--,delete e[t]}this.put=function(t,r,i,o){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==o&&"function"!=typeof o)throw new Error("Cache timeout callback must be a function");var s=e[t];s?clearTimeout(s.timeout):n++;var c={value:r,expire:i+Date.now()};return isNaN(c.expire)||(c.timeout=setTimeout(function(){a(t),o&&o(t,r)}.bind(this),i)),e[t]=c,r},this.del=function(t){var r=!0,n=e[t];return n?(clearTimeout(n.timeout),!isNaN(n.expire)&&n.expire<Date.now()&&(r=!1)):r=!1,r&&a(t),r},this.clear=function(){for(var a in e)clearTimeout(e[a].timeout);n=0,e=Object.create(null),i&&(t=0,r=0)},this.get=function(a){var o=e[a];if(void 0!==o){if(isNaN(o.expire)||o.expire>=Date.now())return i&&t++,o.value;i&&r++,n--,delete e[a]}else i&&r++;return null},this.size=function(){return n},this.memsize=function(){var t,r=0;for(t in e)r++;return r},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return r},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var r in e){var n=e[r];t[r]={value:n.value,expire:n.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,r){var n=JSON.parse(t),i=Date.now(),a=r&&r.skipDuplicates;for(var o in n)if(n.hasOwnProperty(o)){if(a)if(e[o])continue;var s=n[o],c=s.expire-i;if(c<=0){this.del(o);continue}c=c>0?c:void 0,this.put(o,s.value,c)}return this.size()}}e.exports=new n,e.exports.Cache=n},16914:function(e,t,r){"use strict";r.r(t);var n=r(835);r.d(t,"downloadPersonaPhoto",(function(){return n.a}))},203:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o}));var n=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function a(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}function o(e){return n.test(e)}},251:function(e,t,r){"use strict";t.decode=t.parse=r(643),t.encode=t.stringify=r(644)},339:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o}));var n,i=r(0);function a(e){n=e}function o(){var e,t;return Object(i.__awaiter)(this,void 0,void 0,(function(){var r,a;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return(a=n)?[4,n()]:[3,2];case 1:a=i.sent(),i.label=2;case 2:if((r=a)&&r.length>0){if("bearer"===(null===(e=null==r?void 0:r.split(" ")[0])||void 0===e?void 0:e.toLowerCase()))return[2,r.split(" ")[1]];if("msauth1.0"===(null===(t=null==r?void 0:r.split(" ")[0])||void 0===t?void 0:t.toLowerCase()))return[2,r]}return[2,void 0]}}))}))}},401:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(74);function i(e){return Object(n.a)(e,[n.c])}},46:function(e,t,r){"use strict";var n,i,a;r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a})),function(e){e[e.tiny=0]="tiny",e[e.extraExtraSmall=1]="extraExtraSmall",e[e.extraSmall=2]="extraSmall",e[e.small=3]="small",e[e.regular=4]="regular",e[e.large=5]="large",e[e.extraLarge=6]="extraLarge",e[e.size8=17]="size8",e[e.size10=9]="size10",e[e.size16=8]="size16",e[e.size24=10]="size24",e[e.size28=7]="size28",e[e.size32=11]="size32",e[e.size40=12]="size40",e[e.size48=13]="size48",e[e.size56=16]="size56",e[e.size72=14]="size72",e[e.size100=15]="size100",e[e.size120=18]="size120"}(n||(n={})),function(e){e[e.none=0]="none",e[e.offline=1]="offline",e[e.online=2]="online",e[e.away=3]="away",e[e.dnd=4]="dnd",e[e.blocked=5]="blocked",e[e.busy=6]="busy"}(i||(i={})),function(e){e[e.lightBlue=0]="lightBlue",e[e.blue=1]="blue",e[e.darkBlue=2]="darkBlue",e[e.teal=3]="teal",e[e.lightGreen=4]="lightGreen",e[e.green=5]="green",e[e.darkGreen=6]="darkGreen",e[e.lightPink=7]="lightPink",e[e.pink=8]="pink",e[e.magenta=9]="magenta",e[e.purple=10]="purple",e[e.black=11]="black",e[e.orange=12]="orange",e[e.red=13]="red",e[e.darkRed=14]="darkRed",e[e.transparent=15]="transparent",e[e.violet=16]="violet",e[e.lightRed=17]="lightRed",e[e.gold=18]="gold",e[e.burgundy=19]="burgundy",e[e.warmGray=20]="warmGray",e[e.coolGray=21]="coolGray",e[e.gray=22]="gray",e[e.cyan=23]="cyan",e[e.rust=24]="rust"}(a||(a={}))},541:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return p}));var n=r(737),i=r(399),a=r(46),o=r(96),s=r(8),c="email",u="personId",l="UA",f="size",d="/service.svc/s/GetPersonaPhoto";function b(e,t,r,a){if(Object(i.a)()&&e)return Object(n.a)(e,r);var o=Object(s.a)().baseUrl,b="";return e&&(b=h(b,c,e&&e.toLowerCase())),t&&(b=h(b,u,t)),b=h(b,l,"0"),b=h(b,f,a?"HR96x96":"HR64x64"),""+o+d+"?"+b}function p(e,t,r){return Object(i.a)()?Object(n.a)(e,t):"https://cid-"+e+".users.storage.live.com/users/0x"+e+"/myprofile/expressionprofile/profilephoto:"+function(e){switch(e){case a.c.tiny:case a.c.extraExtraSmall:case a.c.extraSmall:case a.c.small:case a.c.regular:case a.c.large:case a.c.size10:case a.c.size8:case a.c.size16:case a.c.size24:case a.c.size28:case a.c.size32:return"UserTileStatic,UserTileSmall";case a.c.extraLarge:case a.c.size40:case a.c.size48:case a.c.size56:case a.c.size72:case a.c.size100:case a.c.size120:return"UserTileMedium,UserTileStatic,UserTileSmall";default:return Object(o.a)(e)}}(r)+"/MeControlMediumUserTile?ck=1&ex=24&fofoff=1"}function h(e,t,r){r&&(r=encodeURIComponent(r));var n=t+"="+r;return e&&(n=e+"&"+n),n}},643:function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,a){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var c=1e3;a&&"number"==typeof a.maxKeys&&(c=a.maxKeys);var u=e.length;c>0&&u>c&&(u=c);for(var l=0;l<u;++l){var f,d,b,p,h=e[l].replace(s,"%20"),v=h.indexOf(r);v>=0?(f=h.substr(0,v),d=h.substr(v+1)):(f=h,d=""),b=decodeURIComponent(f),p=decodeURIComponent(d),n(o,b)?i(o[b])?o[b].push(p):o[b]=[o[b],p]:o[b]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},644:function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?a(o(e),(function(o){var s=encodeURIComponent(n(o))+r;return i(e[o])?a(e[o],(function(e){return s+encodeURIComponent(n(e))})).join(t):s+encodeURIComponent(n(e[o]))})).join(t):s?encodeURIComponent(n(s))+r+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},737:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(6),i="/profile/v1.0/{0}/{1}/image/$value";function a(e,t){var r=e.indexOf("@")>-1,a="GroupMailbox"==t?"groups":"users";return Object(n.c)(i,a,r?e:"cid:"+e)}},835:function(e,t,r){"use strict";var n=r(0),i=r(151),a=Object(i.action)("setIsPendingFetch")((function(e,t){e.personaBlob.isPendingFetch=t})),o=r(2),s=r(206),c=Object(o.mutatorAction)("addBrandToDynamicBrandSet",(function(e,t){t?s.a.dynamicBrandSets.verifiedBrands.set(e,!0):s.a.dynamicBrandSets.unverifiedBrands.set(e,!0)})),u=r(737),l=r(541),f=r(399),d=r(114),b=r(6),p=r(371),h=r(23),v=r(141),m=r(142),g=r(33);r.d(t,"a",(function(){return k}));var O="GetProfileImageTime",y="GetPersonaTime",j="GetProfileImageNoPhoto",z="GetPersonaResponseNoPhoto",w="https://outlook.office.com/M365.Access",x="image_verified_flag",C="outlook.brands.verified_status",R={};function k(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:if(i=e.personaBlob,!t&&(i.isPendingFetch||i.hasFetchFailed||i.blobUrl&&R[i.blobUrl]||Object(b.f)(e.emailAddress)&&Object(b.f)(e.personaId)||(null==r?void 0:r())))return[2];a(e,!0),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,Object(f.a)()?U(e,t):A(e,t)];case 2:return n.sent(),[3,5];case 3:throw o=n.sent(),h.g.warn("Error in getPersonaPhoto "+o),o;case 4:return a(e,!1),[7];case 5:return[2]}}))}))}function A(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,a,o,s,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=P(),i=new Headers,t&&i.append("Cache-Control","no-cache"),[4,Object(m.a)({isUserActivity:!1,returnFullResponseOnSuccess:!0,headers:i,method:"GET"})];case 1:return(a=n.sent()).credentials="same-origin",a.headers.has("X-OWA-CANARY")&&a.headers.delete("X-OWA-CANARY"),a.headers.has("X-Req-Source")&&a.headers.delete("X-Req-Source"),[4,Object(v.a)(Object(l.a)(e.emailAddress,e.personaId),a)];case 2:return o=n.sent(),s=S,c=[e],[4,o.blob()];case 3:return s.apply(void 0,c.concat([n.sent()])),r.end(),[2]}}))}))}function U(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,a,o,s,l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(p.getDelegationTokenForOwa)(w)];case 1:return(r=n.sent())?(i=Object(u.a)(e.emailAddress,e.mailboxType),a={"Content-Type":"image/gif",Authorization:"Bearer "+r,"X-AnchorMailbox":e.emailAddress,image_verified_flag:"","X-RoutingParameter-ResolutionDepth":"Shallow"},t&&(a["Cache-Control"]="no-cache"),o=P(),[4,fetch(i,{method:"GET",mode:"cors",headers:a})]):[2];case 2:return s=n.sent(),Object(f.a)()&&Object(g.i)("rp-brandCards")&&function(e,t){var r=t.headers.get(x);if(null!=r){var n=r.toLowerCase(),i=-1!==n.indexOf(C),a=-1!==n.indexOf(C+" = true");i&&c(e.emailAddress,a)}}(e,s),[4,s.blob()];case 3:return l=n.sent(),S(e,l),o.end(),[2]}}))}))}function P(){var e=Object(f.a)()?O:y;return new d.c(e)}var S=Object(i.action)("processGetPhotoResponse")((function(e,t){a(e,!1);var r,n=0==t.type.toLowerCase().indexOf("image"),i=0==t.type.toLowerCase().indexOf("text/xml"),o=t.size<100;if((n||i)&&!o)return e.personaBlob.blobUrl=URL.createObjectURL(t),R[e.personaBlob.blobUrl]=!0,void(e.personaBlob.hasFetchFailed=!1);r=Object(f.a)()?j:z,Object(d.s)(r),e.personaBlob.hasFetchFailed=!0}))}}]);
//# sourceMappingURL=owa.MailBoot~PersonaPhoto.js.map
self.scriptsLoaded['owa.MailBoot~PersonaPhoto.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~PersonaPhoto.js'] = (new Date()).getTime();