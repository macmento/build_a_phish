self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttachmentPreviewSxSInitialize~CalendarSublimityAssets~FileProviderLink~FileshubOperations~~776bb575.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[69],{2275:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(2601),i=r(2828);function a(e){switch(e){case 3:return s;case 2:return o;case 0:return u;case 1:return l;case 5:return c;default:throw new Error("File provider "+e+" is not supported.")}}var s={providerType:3,create_shared_link_request:{requestUrlFormat:i.a+"/{0}/{1}",method:n.e,body:{shared_link:{access:"open",permissions:{can_download:!0,can_preview:!0}}},dataPointName:"BoxCreateLink"},get_file_info_request:{requestUrlFormat:i.a+"/shared_items",method:n.b,additional_headers:{BoxApi:"shared_link={0}"},dataPointName:"GetBoxFileInfo"}},o={providerType:2,get_shared_link_request:{requestUrlFormat:i.b+"/list_shared_links",method:n.d,body:{path:null,direct_only:!0},dataPointName:"DropboxCreateLink"},create_shared_link_request:{requestUrlFormat:i.b+"/create_shared_link_with_settings",method:n.d,body:{path:null,settings:{requested_visibility:"public"}},dataPointName:"DropboxCreateNewLink"},get_file_info_request:{requestUrlFormat:i.b+"/get_shared_link_metadata",method:n.d,body:{url:null},dataPointName:"GetDropboxFileInfo"}},u={providerType:0,create_shared_link_request:{requestUrlFormat:"https://{0}/"+Object(i.r)(0)+"/{1}/driveItem/invite",method:n.d,additional_headers:{prefer:"getDefaultLink",Application:"Outlook_Web",Scenario:"ShareFile",ScenarioType:"AUO"},dataPointName:"OneDriveProCreateLink"},get_file_info_request:{requestUrlFormat:"https://{0}/"+Object(i.r)(0)+"/{1}/?expand=sharepointIds,permission,driveItem(select=webDavUrl,name,folder,package)",method:n.b,dataPointName:"GetODBFileInfo"},get_shared_item_request:{requestUrlFormat:"https://{0}/"+Object(i.r)(0)+"/{1}/",method:n.b,dataPointName:"GetODBSharedItem",additional_headers:{prefer:"redeemSharingLinkIfNecessary"}}},l={providerType:1,create_shared_link_request:{requestUrlFormat:i.e+"/"+Object(i.i)(1)+"/items/{0}/action.createLink",method:n.d,body:{type:null},dataPointName:"OneDriveConsumerCreateLink"},change_link_permission_request:{requestUrlFormat:i.e+"/"+Object(i.r)(1)+"/{0}/root/action.createLink",method:n.d,body:{type:null},dataPointName:"OneDriveConsumerChangeLinkPermission"},get_drive_item_request:{requestUrlFormat:i.e+"/"+Object(i.r)(1)+"/{0}/driveItem?select=webDavUrl,id,name,file",method:n.b,dataPointName:"GetODCDriveItem"},get_file_permission_request:{requestUrlFormat:i.e+"/"+Object(i.r)(1)+"/{0}/driveItem/permissions",method:n.b,dataPointName:"GetODCFilePermission"}},c={providerType:5,get_file_info_request:{requestUrlFormat:i.d+"/{0}?fields=id,name,webViewLink,mimeType,capabilities,permissions,permissionIds",method:n.b,dataPointName:"GetGDriveFileInfo"},create_shared_link_request:{requestUrlFormat:i.d+"/{0}/permissions",method:n.d,body:{role:null,type:"anyone"},dataPointName:"GDriveCreateLink"},change_link_permission_request:{requestUrlFormat:i.d+"/{0}/permissions/{1}",method:n.c,body:{role:null},dataPointName:"GDriveChangeLinkPermission"}}},2276:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0),i=r(2601);function a(e,t,r,a,s,o,u){return Object(n.__awaiter)(this,void 0,void 0,(function(){var l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return l={method:a,mode:i.a,body:s,datapointNamePrefix:u},[4,Object(i.f)(e,t,o,l,r)];case 1:return[2,n.sent()]}}))}))}},2906:function(e,t,r){"use strict";var n=r(0),i=r(114),a=r(62),s=r(2275),o=r(2276);function u(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,u,l,c,d;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=Object(s.a)(3),i=t?"folders":"files",u=Object(a.a)(r.create_shared_link_request.requestUrlFormat,i,e),[4,Object(o.a)(r.providerType,u,null,r.create_shared_link_request.method,JSON.stringify(r.create_shared_link_request.body),null,r.create_shared_link_request.dataPointName)];case 1:return l=n.sent(),c=JSON.parse(l),d={webUrl:c.shared_link.url,type:O,scope:g},[2,{expirationDateTime:null,shareId:c.id,link:d}]}}))}))}function l(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(2),(r=t.create_shared_link_request.body).path=e,[4,Object(o.a)(t.providerType,t.create_shared_link_request.requestUrlFormat,null,t.create_shared_link_request.method,JSON.stringify(r),null,t.create_shared_link_request.dataPointName)];case 1:return i=n.sent(),[2,JSON.parse(i)]}}))}))}function c(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,a,u;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(2),(r=t.get_shared_link_request.body).path=e,[4,Object(o.a)(t.providerType,t.get_shared_link_request.requestUrlFormat,null,t.get_shared_link_request.method,JSON.stringify(r),null,t.get_shared_link_request.dataPointName)];case 1:return i=n.sent(),(a=JSON.parse(i).links[0])?[3,3]:[4,l(e)];case 2:a=n.sent(),n.label=3;case 3:return u={webUrl:a.url,type:O,scope:g},[2,{expirationDateTime:null,shareId:a.id,link:u}]}}))}))}function d(e){var t=function(e){var t=e.match(/\/d\/(.+)\//gm);return!t||t.length>1?"":t[0].substring(3).replace("/","")}(e);return Object(a.b)(t)&&(t=function(e){var t=e.match(/\/folders\/(.+)$/gm);return!t||t.length>1?"":t[0].substring(9)}(e)),t}function _(e){var t,r;if(e)try{for(var i=Object(n.__values)(e),a=i.next();!a.done;a=i.next()){var s=a.value;if("anyoneWithLink"===s.id)return s.role}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return null}function h(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(5),r=Object(a.a)(t.get_file_info_request.requestUrlFormat,e),[4,Object(o.a)(t.providerType,r,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName)];case 1:return i=n.sent(),[2,JSON.parse(i)]}}))}))}function m(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,a;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,h(d(e))];case 1:return(t=n.sent())&&t.permissionIds&&-1!==t.permissionIds.indexOf("anyoneWithLink")?(r=null,i=0,"reader"===(a=_(t.permissions))?(r=O,i=4):"writer"===a&&(r=v,i=5),[2,{ResultCode:0,FileName:t.name,MimeType:"application/vnd.google-apps.folder"===t.mimeType?q:t.mimeType,SharingLinkKind:i,BlocksDownload:t.capabilities.canDownload,CanShareExternally:!0,CanCreateAnonymousEditLink:!0,CanCreateAnonymousViewLink:!0,ExpirationDate:null,OriginalUrl:null,Type:r,providerFileId:t.id}]):[2,null]}}))}))}function p(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,u,l,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(5),r=Object(a.a)(t.get_file_info_request.requestUrlFormat,e),[4,Object(o.a)(t.providerType,r,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName)];case 1:return i=n.sent(),u=JSON.parse(i),l={webUrl:u.webViewLink,type:null,scope:g},(null==u?void 0:u.permissions)&&("reader"!==(c=_(u.permissions))&&"writer"!==c||(l.type="reader"===c?O:v)),[2,{expirationDateTime:null,shareId:u.id,link:l}]}}))}))}function b(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,u,l,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,p(e)];case 1:return null!=(t=n.sent()).link.type?[3,3]:(r=Object(s.a)(5),i=Object(a.a)(r.create_shared_link_request.requestUrlFormat,e),(u=r.create_shared_link_request.body).role="reader",[4,Object(o.a)(r.providerType,i,null,r.create_shared_link_request.method,JSON.stringify(u),null,r.create_shared_link_request.dataPointName)]);case 2:l=n.sent(),(c=JSON.parse(l))&&"reader"===c.role&&(t.link.type=O),n.label=3;case 3:return[2,t]}}))}))}var f=r(1654),O="view",v="edit",g="anonymous",j="0001-01-01T00:00:00Z",q="text/directory";function y(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,u,l,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=Object(s.a)(1),i=Object(a.a)(r.create_shared_link_request.requestUrlFormat,e),u=!Object(f.g)(t),(l=r.change_link_permission_request.body).type=u?v:O,[4,Object(o.a)(r.providerType,i,null,r.create_shared_link_request.method,JSON.stringify(l),null,r.create_shared_link_request.dataPointName)];case 1:return c=n.sent(),[2,JSON.parse(c)]}}))}))}var w=r(2601),k=r(300);function N(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,u,l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=Object(s.a)(0),null===(i=Object(k.parse)(e).hostname)&&t&&(i=Object(k.parse)(t).hostname,e="https://"+i+e),u=Object(a.a)(r.create_shared_link_request.requestUrlFormat,i,Object(w.g)(e)),[4,Object(o.a)(r.providerType,u,r.create_shared_link_request.additional_headers,r.create_shared_link_request.method,null,e,r.create_shared_link_request.dataPointName)];case 1:return l=n.sent(),[2,JSON.parse(l).value[0]]}}))}))}function F(e,t,r,s,o){return Object(n.__awaiter)(this,void 0,void 0,(function(){var l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:if(Object(a.b)(r))throw new Error("CreateSharingLinkFromFileProvider should have valid location.");switch(l=null,e){case 1:return[3,1];case 0:return[3,3];case 2:return[3,5];case 3:return[3,7];case 5:return[3,9]}return[3,11];case 1:return[4,y(t,r)];case 2:return l=n.sent(),[3,12];case 3:return[4,N(r,o)];case 4:return l=n.sent(),[3,12];case 5:return[4,c(r)];case 6:return l=n.sent(),[3,12];case 7:return[4,u(t,s)];case 8:return l=n.sent(),[3,12];case 9:return[4,b(t)];case 10:return l=n.sent(),[3,12];case 11:throw new Error("File provider "+e+" is not supported.");case 12:return l.expirationDateTime&&Object(i.r)("expiration time found",[l.expirationDateTime]),[2,l]}}))}))}function S(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,u,l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(3),r=t.get_file_info_request.requestUrlFormat,(i=JSON.parse(JSON.stringify(t.get_file_info_request.additional_headers))).BoxApi=Object(a.a)(i.BoxApi,e),[4,Object(o.a)(t.providerType,r,i,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName)];case 1:return u=n.sent(),[2,{ResultCode:0,FileName:(l=JSON.parse(u)).name,MimeType:"folder"===l.type?q:null,SharingLinkKind:4,BlocksDownload:!l.shared_link.permissions.can_download,CanShareExternally:!0,ExpirationDate:null,OriginalUrl:null,Type:O,providerFileId:l.id,location:e}]}}))}))}function P(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,a;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(2),(r=t.get_file_info_request.body).url=e,[4,Object(o.a)(t.providerType,t.get_file_info_request.requestUrlFormat,null,t.get_file_info_request.method,JSON.stringify(r),null,t.get_file_info_request.dataPointName)];case 1:return i=n.sent(),[2,{ResultCode:0,FileName:(a=JSON.parse(i)).name,MimeType:"folder"===a[".tag"]?q:null,SharingLinkKind:4,BlocksDownload:!a.link_permissions.allow_download,CanShareExternally:!0,ExpirationDate:null,OriginalUrl:null,Type:O,providerFileId:a.id,location:e}]}}))}))}var D=r(23);function T(e){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t,r,i,u;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(s.a)(0),r=Object(k.parse)(e),i=Object(a.a)(t.get_file_info_request.requestUrlFormat,r.hostname,Object(w.g)(e)),[4,Object(o.a)(t.providerType,i,null,t.get_file_info_request.method,null,null,t.get_file_info_request.dataPointName)];case 1:return u=n.sent(),D.g.info(u),[2,null]}}))}))}var U=r(5992),C=r(33);function x(e){var t;return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,u,l,c,d,_,h;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:r=Object(s.a)(1),u=Object(a.a)(r.get_file_permission_request.requestUrlFormat,Object(w.g)(e)),(c=Object(C.i)("doc-link-cogs"))&&Object(i.r)("getODCFilePermissionWithReadOnlyHeader"),n.label=1;case 1:return n.trys.push([1,3,,7]),[4,Object(o.a)(r.providerType,u,c?{Prefer:"eventualconsistencyreadonly"}:null,r.get_file_permission_request.method,null,null,r.get_file_permission_request.dataPointName)];case 2:return _=n.sent(),l=JSON.parse(_),[3,7];case 3:return d=n.sent(),c&&404===(null===(t=JSON.parse(d))||void 0===t?void 0:t.responseStatus)?(Object(i.r)("getODCFilePermissionRetryOnNotFound"),[4,Object(o.a)(r.providerType,u,null,r.get_file_permission_request.method,null,null,r.get_file_permission_request.dataPointName)]):[3,5];case 4:return _=n.sent(),l=JSON.parse(_),[3,6];case 5:throw d;case 6:return[3,7];case 7:if(l.value.forEach((function(t){var r,n;(null===(r=t.link)||void 0===r?void 0:r.webUrl)&&0===e.indexOf(null===(n=t.link)||void 0===n?void 0:n.webUrl)&&(h=t)})),!h)throw new Error("GetODCSharingInfo failed to find the matching link");return[2,h]}}))}))}function I(e){var t;return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,a,s;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(U.a)(e)];case 1:return r=n.sent(),[4,x(e)];case 2:return a=n.sent(),s=(null===(t=a.invitation)||void 0===t?void 0:t.signInRequired)?6:a.link.type===v?5:4,Object(i.r)("getODCFileInfo",{isPSL:6===s}),[2,{ResultCode:0,FileName:r.name,MimeType:r.file?r.file.mimeType:q,SharingLinkKind:s,BlocksDownload:!1,CanShareExternally:!0,CanCreateAnonymousEditLink:!0,CanCreateAnonymousViewLink:!0,ExpirationDate:a.expirationDateTime===j?null:a.expirationDateTime,OriginalUrl:null,Type:a.link.type,providerFileId:r.id,location:e}]}}))}))}function L(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(r){switch(t){case 0:return[2,T(e)];case 1:return[2,I(e)];case 2:return[2,P(e)];case 3:return[2,S(e)];case 5:return[2,m(e)];default:throw new Error("getFileInfo is not supported for "+t+".")}return[2]}))}))}function J(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,u,l,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:switch(t){case 4:case 3:break;default:throw new Error("We do not support this permission level for GDrive: "+t)}return r=d(e),i=Object(s.a)(5),u=Object(a.a)(i.change_link_permission_request.requestUrlFormat,r,"anyoneWithLink"),l=i.change_link_permission_request.body,c=4===t?"writer":"reader",l.role=c,[4,Object(o.a)(i.providerType,u,null,i.change_link_permission_request.method,JSON.stringify(l),null,i.change_link_permission_request.dataPointName)];case 1:return n.sent(),[2]}}))}))}function E(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,u,l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:switch(t){case 4:case 3:break;default:throw new Error("OneDriveConsumer does not support this permission level: "+t)}return r=Object(s.a)(1),i=Object(a.a)(r.change_link_permission_request.requestUrlFormat,Object(w.g)(e)),(u=r.change_link_permission_request.body).type=4===t?v:O,[4,Object(o.a)(r.providerType,i,null,r.change_link_permission_request.method,JSON.stringify(u),null,r.change_link_permission_request.dataPointName)];case 1:return l=n.sent(),[2,JSON.parse(l)]}}))}))}function G(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){return Object(n.__generator)(this,(function(n){switch(n.label){case 0:if(Object(a.b)(t))throw new Error("CreateSharingLinkFromFileProvider should have valid location.");return 1!==e?[3,2]:[4,E(t,r)];case 1:return[2,n.sent()];case 2:return 5!==e?[3,4]:[4,J(t,r)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}r.d(t,"i",(function(){return F})),r.d(t,"j",(function(){return L})),r.d(t,"e",(function(){return O})),r.d(t,"d",(function(){return v})),r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return"organization"})),r.d(t,"c",(function(){return"user"})),r.d(t,"g",(function(){return j})),r.d(t,"f",(function(){return q})),r.d(t,"h",(function(){return G}))},5992:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(0),i=r(114),a=r(2601),s=r(33),o=r(62),u=r(2275),l=r(2276);function c(e){var t;return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,c,d,_,h;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:r=Object(u.a)(1),c=Object(o.a)(r.get_drive_item_request.requestUrlFormat,Object(a.g)(e)),(d=Object(s.i)("doc-link-cogs"))&&Object(i.r)("getODCDriveItemWithReadOnlyHeader"),n.label=1;case 1:return n.trys.push([1,3,,7]),[4,Object(l.a)(r.providerType,c,d?{Prefer:"eventualconsistencyreadonly"}:null,r.get_drive_item_request.method,null,null,r.get_drive_item_request.dataPointName)];case 2:return h=n.sent(),[2,JSON.parse(h)];case 3:return _=n.sent(),d&&404===(null===(t=JSON.parse(_))||void 0===t?void 0:t.responseStatus)?(Object(i.r)("getODCDriveItemRetryOnNotFound"),[4,Object(l.a)(r.providerType,c,null,r.get_drive_item_request.method,null,null,r.get_drive_item_request.dataPointName)]):[3,5];case 4:return h=n.sent(),[2,JSON.parse(h)];case 5:throw _;case 6:return[3,7];case 7:return[2]}}))}))}}}]);
//# sourceMappingURL=owa.MailBoot~AttachmentPreviewSxSInitialize~CalendarSublimityAssets~FileProviderLink~FileshubOperations~~776bb575.js.map
self.scriptsLoaded['owa.MailBoot~AttachmentPreviewSxSInitialize~CalendarSublimityAssets~FileProviderLink~FileshubOperations~~776bb575.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttachmentPreviewSxSInitialize~CalendarSublimityAssets~FileProviderLink~FileshubOperations~~776bb575.js'] = (new Date()).getTime();